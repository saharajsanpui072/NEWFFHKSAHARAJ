<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡¶∏‡¶æ‡¶π‡¶æ‡¶∞‡¶æ‡¶ú ‡¶ï‡¶≤ ¬∑ ‡¶ó‡ßç‡¶≤‡¶æ‡¶∏ ‡¶Æ‡¶∞‡¶´‡¶ø‡¶ú‡¶Æ</title>
  <!-- Firebase SDK (for realtime sync simulation) -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at 30% 30%, #1a1f2e, #0b0d15);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    /* –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä ‚Äî —Ç–æ—á–Ω—ã–π glass‚Äë–º–æ—Ä—Ñ–∏–∑–º –∫–∞–∫ –Ω–∞ —Ñ–æ—Ç–æ */
    .app-container {
      width: 100%;
      max-width: 380px;
      background: rgba(18, 22, 33, 0.7);
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      border-radius: 42px;
      border: 1px solid rgba(120, 140, 180, 0.2);
      box-shadow: 0 30px 50px rgba(0, 0, 0, 0.7), inset 0 1px 2px rgba(255, 255, 255, 0.08);
      padding: 24px 18px;
      color: #eef3fc;
      transition: all 0.2s;
    }

    /* –æ–±—â–∏–µ —ç–∫—Ä–∞–Ω—ã */
    .screen {
      display: none;
      flex-direction: column;
      gap: 22px;
    }

    .screen.active {
      display: flex;
    }

    /* –≤–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞ —Å –ø–∏–Ω–≥–æ–º */
    .ping-bar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 15px;
      font-weight: 500;
      letter-spacing: 0.3px;
      background: rgba(10, 15, 25, 0.5);
      padding: 10px 16px;
      border-radius: 40px;
      border: 1px solid rgba(200, 220, 255, 0.1);
      backdrop-filter: blur(10px);
      color: #b3ceff;
    }

    .ping-value {
      background: #1e2638;
      padding: 4px 14px;
      border-radius: 40px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 15px;
      color: #b5e5ff;
      box-shadow: inset 0 2px 5px #00000055;
    }

    /* –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Ç–æ—á–Ω–æ –∫–∞–∫ –≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏) */
    .contact-list {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .contact-item {
      background: rgba(25, 32, 48, 0.6);
      backdrop-filter: blur(8px);
      border-radius: 34px;
      padding: 16px 20px;
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 8px 20px -10px #00000099;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: 0.1s;
      cursor: pointer;
    }

    .contact-item:active {
      background: rgba(45, 55, 80, 0.8);
      transform: scale(0.99);
    }

    .left-col {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .contact-name {
      font-size: 20px;
      font-weight: 600;
      background: linear-gradient(135deg, #ffffff, #c0d4ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .contact-uid {
      font-size: 13px;
      font-family: 'JetBrains Mono', monospace;
      color: #9bb4e0;
      background: #1a2333;
      padding: 4px 12px;
      border-radius: 30px;
      display: inline-block;
      letter-spacing: 0.5px;
      border: 1px solid #2f3b54;
    }

    .ping-badge {
      text-align: right;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 500;
      background: #0f1624;
      padding: 8px 16px;
      border-radius: 32px;
      font-size: 16px;
      color: #9bd7ff;
      box-shadow: inset 0 3px 6px #00000088;
      white-space: nowrap;
    }

    .ping-badge span {
      color: #ffa56e;
      font-weight: 400;
      margin-left: 6px;
    }

    /* –ø–æ–∏—Å–∫ */
    .search-box {
      background: rgba(10, 15, 27, 0.7);
      border-radius: 40px;
      padding: 12px 22px;
      border: 1px solid #334155;
      color: #a3c6ff;
      font-size: 16px;
      backdrop-filter: blur(10px);
      outline: none;
      width: 100%;
    }

    .search-box::placeholder {
      color: #5f739b;
      font-weight: 400;
    }

    /* —ç–∫—Ä–∞–Ω –∑–≤–æ–Ω–∫–∞ */
    .call-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }

    .call-contact-name {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(135deg, #ffffff, #c9dcff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .call-uid {
      font-family: monospace;
      background: #1f2a3f;
      padding: 8px 22px;
      border-radius: 60px;
      font-size: 15px;
      color: #b2d0ff;
      border: 1px solid #3f5170;
    }

    .video-placeholder {
      width: 100%;
      aspect-ratio: 16/9;
      background: #0d1220;
      border-radius: 32px;
      margin: 20px 0 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 2px solid #2b3d60;
      box-shadow: 0 0 0 1px #70b0ff33;
      font-size: 18px;
      font-weight: 500;
      color: #7b98c9;
      text-align: center;
      padding: 0 20px;
      backdrop-filter: blur(5px);
    }

    .noise-indicator {
      background: #142337;
      border-radius: 60px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      color: #aad0ff;
      border: 1px solid #376f9a;
      box-shadow: 0 0 8px #0088ff33;
      letter-spacing: 0.5px;
      margin: 10px 0;
    }

    .end-call-btn {
      background: #d14545;
      border: none;
      border-radius: 70px;
      padding: 18px 30px;
      font-size: 22px;
      font-weight: 700;
      color: white;
      box-shadow: 0 10px 25px #aa0000aa;
      margin-top: 20px;
      cursor: pointer;
      transition: 0.1s;
      border: 1px solid #ffa2a2;
    }

    .end-call-btn:active {
      background: #b02b2b;
      transform: scale(0.97);
    }

    /* –∫–Ω–æ–ø–∫–∏ –≤—Ç–æ—Ä–∏—á–Ω—ã–µ */
    .dev-btn {
      background: #253141;
      border: none;
      border-radius: 40px;
      padding: 10px 16px;
      color: #badaff;
      font-size: 14px;
      margin-top: 12px;
      cursor: pointer;
      border: 1px solid #4c6188;
    }

    /* —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è */
    .uid-display {
      background: #192132;
      border-radius: 60px;
      padding: 16px;
      text-align: center;
      font-size: 20px;
      letter-spacing: 2px;
      border: 1px solid #6a7fa0;
      font-family: monospace;
    }

    .name-input {
      background: #1a2338;
      border: 1px solid #546b99;
      border-radius: 50px;
      padding: 18px 22px;
      font-size: 18px;
      color: white;
      outline: none;
    }

    .save-btn {
      background: #2b6eb0;
      border: none;
      border-radius: 60px;
      padding: 18px;
      font-weight: 700;
      font-size: 22px;
      color: white;
      box-shadow: 0 6px 0 #123456;
      cursor: pointer;
    }

    /* –º–µ–ª–∫–∏–µ –¥–µ—Ç–∞–ª–∏ */
    .ms-detail {
      font-size: 13px;
      color: #7f9fd5;
      margin-top: 4px;
    }

    .flex {
      display: flex;
      align-items: center;
      gap: 8px;
    }
  </style>
</head>
<body>
<div class="app-container" id="appContainer">

  <!-- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —ç–∫—Ä–∞–Ω (home) -->
  <div class="screen active" id="homeScreen">
    <div class="ping-bar">
      <span>üì∂ Your Ping</span>
      <span class="ping-value" id="homePing">35 ms</span>
    </div>
    <div style="font-size: 38px; margin: 10px 0 0;">üë§</div>
    <div class="uid-display" id="uidDisplay">X7Y9Z3A1B5</div>
    <input type="text" class="name-input" id="nameInput" placeholder="What's your name?" value="‡¶∏‡¶æ‡¶π‡¶æ‡¶∞‡¶æ‡¶ú">
    <button class="save-btn" id="saveEnterBtn">Save & Enter</button>
    <div style="font-size: 13px; color: #6a7da0; text-align: center; margin-top: 15px;">UID auto‚Äëgenerated</div>
  </div>

  <!-- —ç–∫—Ä–∞–Ω –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è) -->
  <div class="screen" id="contactsScreen">
    <div class="ping-bar">
      <span>üì° Your Ping</span>
      <span class="ping-value" id="contactsPing">35 ms</span>
    </div>
    <input type="text" class="search-box" placeholder="Find users..." value="Find users...">
    
    <div class="contact-list" id="contactList">
      <!-- –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –∏–∑ js / –Ω–æ –º–æ–∂–Ω–æ –∏ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –º–∞–ª–µ–Ω—å–∫–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –¥–µ–º–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–Ω–µ –º–µ—à–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–º—É UI) -->
    <button class="dev-btn" id="simulateRemoteEndBtn" style="display: none;">‚ö° remote end (dev)</button>
  </div>

  <!-- —ç–∫—Ä–∞–Ω –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–≤–æ–Ω–∫–∞ -->
  <div class="screen" id="callScreen">
    <div class="ping-bar">
      <span>üìû Call with</span>
      <span class="ping-value" id="callPing">-- ms</span>
    </div>
    <div class="call-header">
      <span class="call-contact-name" id="callContactName">Rina</span>
      <span class="call-uid" id="callContactUID">P2Q466S8T0</span>
    </div>

    <!-- –≤–∏–¥–µ–æ-—Ö–æ–ª–¥–µ—Ä —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ —Å–ª–∞–±–æ–π —Å–µ—Ç–∏ -->
    <div class="video-placeholder" id="videoHoldMessage">
      üìπ Video active
    </div>

    <!-- –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π Noise Cancellation (–±–µ–∑ –∫–Ω–æ–ø–∫–∏) -->
    <div class="noise-indicator">üé§ Noise Cancellation Active</div>

    <!-- –∫–Ω–æ–ø–∫–∞ –∑–∞–≤–µ—Ä—à–∏—Ç—å –∑–≤–æ–Ω–æ–∫ -->
    <button class="end-call-btn" id="endCallBtn">End Call</button>

    <!-- —Å–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö ms (–∫–∞–∫ –Ω–∞ –≤—Ç–æ—Ä–æ–º —Ñ–æ—Ç–æ) -->
    <div style="display: flex; justify-content: center; gap: 20px; margin-top: 8px; color: #6d93d0; font-family: monospace;">
      <span id="extraMs1">38 ms</span>
      <span id="extraMs2">38 ms</span>
    </div>
  </div>

</div>

<script>
  (function() {
    // ---------- firebase init (–¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ –º–∏–Ω–∏–º—É–º—É) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAMvHlgZmaxdNIHWMVc8nXb1h-A0YUR0qI",
      authDomain: "mycallingapp-8677d.firebaseapp.com",
      databaseURL: "https://mycallingapp-8677d-default-rtdb.firebaseio.com",
      projectId: "mycallingapp-8677d",
      storageBucket: "mycallingapp-8677d.firebasestorage.app",
      messagingSenderId: "75951551570",
      appId: "1:75951551570:android:d7de2090c4c70bba7fdb8b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // ---------- –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ----------
    let myUID = localStorage.getItem('myUID');
    let myName = localStorage.getItem('myName');
    let currentPing = 35; // —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ
    let pingInterval;
    let callActive = false;
    let currentCalleeUID = null;
    let currentCalleeName = null;
    let callListener = null;

    // —Ö–∞—Ä–¥–∫–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)
    const contacts = [
      { name: 'Rina', uid: 'P2Q466S8T0', ms: '28 ms + 120 ms', extra: '+ 120 ms' },
      { name: 'Amit', uid: 'A1B3C55D7E9', ms: '+ 120 ms + 40 ms', extra: '+ 40 ms' },
      { name: 'Joy', uid: 'L9M1N44-P5Q7', ms: '+ 350 ms + 40 ms', extra: '+ 40 ms' },
      { name: 'Sumi', uid: 'SUMI99X8Z', ms: '+ 45 ms', extra: '' }  // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π uid –¥–ª—è —Å—É–º–º—ã
    ];

    // —ç–ª–µ–º–µ–Ω—Ç—ã —ç–∫—Ä–∞–Ω–æ–≤
    const homeScreen = document.getElementById('homeScreen');
    const contactsScreen = document.getElementById('contactsScreen');
    const callScreen = document.getElementById('callScreen');
    const homePingSpan = document.getElementById('homePing');
    const contactsPingSpan = document.getElementById('contactsPing');
    const callPingSpan = document.getElementById('callPing');
    const uidDisplay = document.getElementById('uidDisplay');
    const nameInput = document.getElementById('nameInput');
    const saveBtn = document.getElementById('saveEnterBtn');
    const contactListDiv = document.getElementById('contactList');
    const callContactName = document.getElementById('callContactName');
    const callContactUID = document.getElementById('callContactUID');
    const endCallBtn = document.getElementById('endCallBtn');
    const videoHoldMsg = document.getElementById('videoHoldMessage');
    const extraMs1 = document.getElementById('extraMs1');
    const extraMs2 = document.getElementById('extraMs2');

    // –µ—Å–ª–∏ –Ω–µ—Ç UID ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º
    if (!myUID) {
      myUID = Math.random().toString(36).substring(2, 12).toUpperCase();
      localStorage.setItem('myUID', myUID);
    }
    uidDisplay.innerText = myUID;
    if (myName) nameInput.value = myName;

    // ---------- —Å–∏–º—É–ª—è—Ü–∏—è –ø–∏–Ω–≥–∞ (ms –º–µ–Ω—è–µ—Ç—Å—è) ----------
    function updatePing() {
      // —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–ª–µ–±–∞–Ω–∏—è 20-150 ms, –∏–Ω–æ–≥–¥–∞ —Å–∫–∞—á–∫–∏ –¥–æ 350
      let variation = Math.floor(Math.random() * 50) + 15;
      if (Math.random() > 0.7) variation += 200; // —Å–ª–∞–±–∞—è —Å–µ—Ç—å
      currentPing = 25 + variation;
      if (currentPing > 380) currentPing = 380;
      const pingText = currentPing + ' ms';
      homePingSpan.innerText = pingText;
      contactsPingSpan.innerText = pingText;
      callPingSpan.innerText = pingText;

      // –≤–∏–¥–µ–æ-—Ö–æ–ª–¥ –ø—Ä–∏ –ø–ª–æ—Ö–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ (>200ms)
      if (callScreen.classList.contains('active')) {
        if (currentPing > 200) {
          videoHoldMsg.innerText = 'üìπ Video on Hold due to weak connection';
        } else {
          videoHoldMsg.innerText = 'üìπ Video active';
        }
      }

      // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–∏—Ñ–µ—Ä–∫–∏ –∫–∞–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–µ (–∫–æ–ª–µ–±–ª—é—Ç—Å—è)
      extraMs1.innerText = (Math.floor(Math.random() * 30) + 25) + ' ms';
      extraMs2.innerText = (Math.floor(Math.random() * 30) + 25) + ' ms';
    }
    pingInterval = setInterval(updatePing, 2700);
    updatePing();

    // ---------- –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ (—Ç–æ—á–Ω—ã–π –¥–∏–∑–∞–π–Ω –∏–∑ —Ñ–æ—Ç–æ) ----------
    function renderContacts() {
      let html = '';
      contacts.forEach(c => {
        html += `
          <div class="contact-item" data-uid="${c.uid}" data-name="${c.name}">
            <div class="left-col">
              <span class="contact-name">${c.name}</span>
              <span class="contact-uid">${c.uid}</span>
            </div>
            <div class="ping-badge">
              ${c.ms} <span>‚ö°</span>
            </div>
          </div>
        `;
      });
      contactListDiv.innerHTML = html;

      // –Ω–∞–∑–Ω–∞—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ (–Ω–∞—á–∞—Ç—å –∑–≤–æ–Ω–æ–∫)
      document.querySelectorAll('.contact-item').forEach(el => {
        el.addEventListener('click', (e) => {
          const uid = el.dataset.uid;
          const name = el.dataset.name;
          startCall(uid, name);
        });
      });
    }
    renderContacts();

    // ---------- —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞—á–∞–ª–∞ –∑–≤–æ–Ω–∫–∞ ----------
    function startCall(calleeUid, calleeName) {
      if (callActive) return;
      callActive = true;
      currentCalleeUID = calleeUid;
      currentCalleeName = calleeName;

      // –æ–±–Ω–æ–≤–ª—è–µ–º UI –∑–≤–æ–Ω–∫–∞
      callContactName.innerText = calleeName;
      callContactUID.innerText = calleeUid;

      // –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω
      homeScreen.classList.remove('active');
      contactsScreen.classList.remove('active');
      callScreen.classList.add('active');

      // –∑–∞–ø–∏—Å—å –≤ Firebase: –∏–Ω–∏—Ü–∏–∏—Ä—É–µ–º –∑–≤–æ–Ω–æ–∫ (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º–∏ –≤–∫–ª–∞–¥–∫–∞–º–∏)
      const callRef = db.ref('calls/' + calleeUid);
      callRef.set({
        active: true,
        caller: myUID,
        timestamp: Date.now()
      });

      // —Å–ª—É—à–∞–µ–º –æ—Ç–º–µ–Ω—É –∑–≤–æ–Ω–∫–∞ (–µ—Å–ª–∏ —É–¥–∞–ª—ë–Ω –∏–∑ –±–∞–∑—ã ‚Äî –∑–Ω–∞—á–∏—Ç –¥—Ä—É–≥–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø–æ–ª–æ–∂–∏–ª–∞ —Ç—Ä—É–±–∫—É)
      if (callListener) callListener.off();
      callListener = db.ref('calls/' + calleeUid).on('value', (snap) => {
        const data = snap.val();
        // –µ—Å–ª–∏ –∑–≤–æ–Ω–æ–∫ —É–¥–∞–ª—ë–Ω (null) –∏ –º—ã –≤—Å—ë –µ—â—ë –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –∑–≤–æ–Ω–∫–µ ‚Äî –∑–∞–≤–µ—Ä—à–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
        if (!data && callActive && currentCalleeUID === calleeUid) {
          endCall(true); // true = —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω–µ—Ü –æ—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
        }
      });

      // –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ü–∞ —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ —Å–∏–º—É–ª–∏—Ä—É–µ–º "–¥—Ä—É–≥–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø–æ–ª–æ–∂–∏–ª–∞"
      // –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—Ç–∫–ª—é—á–∞—Ç –≤—Ä—É—á–Ω—É—é
      setTimeout(() => {
        if (callActive && currentCalleeUID === calleeUid) {
          // –∏–º–∏—Ç–∞—Ü–∏—è —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ü–∞ ‚Äî —É–¥–∞–ª—è–µ–º –Ω–æ–¥—É
          db.ref('calls/' + calleeUid).remove();
        }
      }, 20000); // —á–µ—Ä–µ–∑ 20 —Å–µ–∫ –∞–≤—Ç–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–∫–∞–∫ –¥–µ–º–æ)
    }

    // ---------- —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–≤–æ–Ω–∫–∞ (sync) ----------
    function endCall(silent = false) {
      if (!callActive) return;
      callActive = false;

      // —É–¥–∞–ª—è–µ–º –Ω–æ–¥—É –≤ Firebase (—Å–∏–≥–Ω–∞–ª –¥—Ä—É–≥–∏–º, —á—Ç–æ –º—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏)
      if (currentCalleeUID) {
        db.ref('calls/' + currentCalleeUID).remove();
      }

      // –æ—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å–ª—É—à–∞—Ç–µ–ª—è
      if (callListener) {
        callListener.off();
        callListener = null;
      }

      // –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
      callScreen.classList.remove('active');
      contactsScreen.classList.add('active');

      // –Ω–µ–±–æ–ª—å—à–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
      if (!silent) console.log('call ended by user');
      currentCalleeUID = null;
    }

    // –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ End Call
    endCallBtn.addEventListener('click', () => {
      endCall();
    });

    // ---------- —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ –ø–µ—Ä–µ—Ö–æ–¥ ----------
    saveBtn.addEventListener('click', () => {
      const enteredName = nameInput.value.trim();
      if (enteredName) {
        localStorage.setItem('myName', enteredName);
        myName = enteredName;
      }
      homeScreen.classList.remove('active');
      contactsScreen.classList.add('active');
    });

    // –µ—Å–ª–∏ —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∏–º—è ‚Äî —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–∞–∫—Ç—ã
    if (myName) {
      homeScreen.classList.remove('active');
      contactsScreen.classList.add('active');
    }

    // ---------- –∫–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–π —Å–∏–º—É–ª—è—Ü–∏–∏ "remote end" (—Å–ø—Ä—è—Ç–∞–Ω–∞, –Ω–æ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å) ----------
    const remoteBtn = document.getElementById('simulateRemoteEndBtn');
    remoteBtn.style.display = 'block'; // –ø–æ–∫–∞–∂–µ–º –¥–ª—è –¥–µ–º–æ
    remoteBtn.addEventListener('click', () => {
      if (currentCalleeUID) {
        db.ref('calls/' + currentCalleeUID).remove(); // —Å–∏–º—É–ª–∏—Ä—É–µ–º –∫–æ–Ω–µ—Ü —Å —Ç–æ–π —Å—Ç–æ—Ä–æ–Ω—ã
      }
    });

    // ---------- –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–µ—Ç–∞–ª—å: –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–≤–æ–Ω–æ–∫ –í–•–û–î–Ø–©–ò–ô (–¥–ª—è –∫—Ä–æ—Å—Å-—Ç–∞–±–æ–≤) ----------
    // –°–ª—É—à–∞–µ–º –≤—ã–∑–æ–≤—ã –Ω–∞ –Ω–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π UID (–µ—Å–ª–∏ –∫—Ç–æ-—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞—Å)
    db.ref('calls/' + myUID).on('value', (snap) => {
      const data = snap.val();
      // –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∑–≤–æ–Ω–æ–∫ –Ω–∞ –Ω–∞—à UID –∏ –º—ã –Ω–µ –∑–∞–Ω—è—Ç—ã (–Ω–µ –≤ –∏—Å—Ö–æ–¥—è—â–µ–º)
      if (data && data.active && data.caller !== myUID && !callActive) {
        // –∞–≤—Ç–æ-–æ—Ç–≤–µ—Ç (–¥–ª—è –¥–µ–º–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º —á—Ç–æ –≤—Ö–æ–¥—è—â–∏–π, –Ω–æ –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –ø—Ä–∏–º–µ–º —Å—Ä–∞–∑—É)
        // –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –Ω–∞–¥–æ —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å, –Ω–æ –º—ã —Å–∏–º—É–ª–∏—Ä—É–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ 1—Å
        setTimeout(() => {
          if (!callActive) {
            // —É–∑–Ω–∞—ë–º –∏–º—è –∑–≤–æ–Ω—è—â–µ–≥–æ (–ø–æ–¥–±–µ—Ä—ë–º –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤)
            const callerContact = contacts.find(c => c.uid === data.caller);
            const callerName = callerContact ? callerContact.name : 'Unknown';
            startCall(data.caller, callerName);
          }
        }, 1000);
      }
    });

    // –æ—á–∏—Å—Ç–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    window.addEventListener('beforeunload', () => {
      clearInterval(pingInterval);
      if (currentCalleeUID) {
        db.ref('calls/' + currentCalleeUID).remove(); // —á–∏—Å—Ç–∏–º –∑–∞ —Å–æ–±–æ–π
      }
    });

    // –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –ª—é–±–æ–π –∫–æ–Ω—Ç–∞–∫—Ç —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ renderContacts

    // –º–µ–ª–∫–∏–µ –ø—Ä–∞–≤–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ: –≤—Ç–æ—Ä–æ–π —ç–∫—Ä–∞–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–≤–µ —Å—Ç—Ä–æ–∫–∏ –ø–∏–Ω–≥–∞, —É–∂–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
    // —Ç–µ–∫—Å—Ç "Noise Cancellation Active" –≤—Å–µ–≥–¥–∞ –≤–∏–¥–µ–Ω, –∫–Ω–æ–ø–æ–∫ –Ω–µ—Ç.

    // —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —à—Ç—Ä–∏—Ö: –∏–º—è "‡¶∏‡¶æ‡¶π‡¶æ‡¶∞‡¶æ‡¶ú" —É–∂–µ –≤ –∏–Ω–ø—É—Ç–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  })();
</script>
<!-- –≥–∞—Ä–∞–Ω—Ç–∏—è, —á—Ç–æ –ø–∏–Ω–≥ –º–µ–Ω—è–µ—Ç—Å—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ —Ö–æ–ª–¥–µ –ø–æ—è–≤–ª—è–µ—Ç—Å—è -->
</body>
</html>